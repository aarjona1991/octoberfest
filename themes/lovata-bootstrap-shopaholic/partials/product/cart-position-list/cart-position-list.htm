{# @var obCartPositionList \Lovata\OrdersShopaholic\Classes\Collection\CartPositionCollection #}
{# @var obCartPosition \Lovata\OrdersShopaholic\Classes\Item\CartPositionItem #}
{# @var obActiveShippingType \Lovata\OrdersShopaholic\Classes\Item\ShippingTypeItem #}
{# @var obOffer \Lovata\Shopaholic\Classes\Item\OfferItem #}
{# @var obProduct \Lovata\Shopaholic\Classes\Item\ProductItem #}

<section class="row cart">
    {% if obCartPositionList.isNotEmpty() %}
    <div class="col-12">
        <h2 class="cart__table-title mt-4 mb-4 text-center">Your cart</h2>
    </div>
    <div class="col-12">
        <div class="row">
            <div class="col-lg-9">
                <div class="col-12 flex-cart cart__table cart__table-wrapper table-responsive border-bottom mb-4">
                    <div class="py-4 row border-top border-bottom headline">
                        <div class="col-12 d-flex">
                            <div class="col-first">
                                <div class="col-12"></div>
                            </div>
                            <div class="col-second d-flex">
                                <div class="attr-col">Product</div>
                                <div class="attr-col">Price</div>
                                <div class="attr-col">QTY</div>
                                <div class="attr-col">Amount</div>
                                <div class="col"></div>
                            </div>
                        </div>
                    </div>
                    <div class="item-list">
                        {% for obCartPosition in obCartPositionList %}
                        {% set obOffer = obCartPosition.offer %}
                        {% set obProduct = obOffer.product %}
                        <div class="row cart__item cart-item border-top {% if obCartPosition.quantity > obOffer.quantity %}bg-danger{% endif %}"
                             data-position-id="{{ obCartPosition.id }}" data-offer-id="{{ obOffer.id }}">
                            <div class="col-first">
                                <div class="col-12">
                                    <a href="{{ obProduct.getPageUrl('catalog') }}" class="cart__img-wrap"
                                       aria-label="Read more about {{ obProduct.name }}">
                                        {% if obProduct.preview_image is not empty %}
                                        <img class="cart__img"
                                             src="{{ obProduct.preview_image.getThumb(400, 400, {quality: 80}) }}"
                                             alt="{{ obProduct.preview_image.description }}"
                                             title="{{ obProduct.preview_image.title }}" loading="lazy">
                                        {% else %}
                                        <img class="cart__img" src="{{ 'assets/images/no-image.png'|theme }}">
                                        {% endif %}
                                    </a>
                                </div>
                            </div>
                            <div class="col-second">
                                <div class="attr-col">
                                    <a class="cart__product-name font-weight-bold d-block mb-2"
                                       href="{{ obProduct.getPageUrl('catalog') }}">
                                        {{ obProduct.name }}
                                    </a>
                                    <a href="{{ obProduct.category.getPageUrl('catalog') }}"
                                       class="cart__category-product-column text-dark">
                                        {{ obProduct.category.name }}
                                    </a>
                                </div>
                                <div class="attr-col">
                                    <div class="cart__price-bar d-flex flex-column">
                                        <h5>Price</h5>
                                        <span class="cart__current-price pr-2 font-weight-bold {{ obOffer.old_price_value > 0 ? 'text-danger' : '' }} d-block mb-1">
                                            {{ obOffer.price }}  {{ obOffer.currency }}
                                        </span>
                                        {% if obOffer.old_price_value > 0 %}
                                        <span class="cart__old-price text-muted pr-2">
                                            <s>{{ obOffer.old_price }} {{ obOffer.currency }}</s>
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="attr-col">
                                    <h5>Qty</h5>
                                    {% partial 'form/button-change-quantity/button-change-quantity'
                                    btnChangeQtyValue=obCartPosition.quantity btnChangeQtyAjax=true
                                    btnMaxQtyValue=obOffer.quantity %}
                                </div>
                                <div class="attr-col">
                                    <h5>Amount</h5>
                                    <span class="cart__total-price-figures cart__position-price-value">{{ obCartPosition.price }} {{ obCartPosition.currency }}</span>
                                    <span class="text-muted cart__position-old-price-figures {% if obCartPosition.discount_price_value == 0 %}d-none{% endif %}">
                                    <span class="cart__position-old-price-value">{{ obCartPosition.old_price }} {{ obCartPosition.currency }}</span>
                                </span>
                                </div>
                                <div class="attr-col">
                                    <button class="btn btn-outline-secondary btn_bg-white cart__delete-btn"
                                            aria-label="Delete" data-id="{{ obOffer.id }}">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="col border cart__total mb-5">
                    <div class="cart__total-position row justify-content-lg-around border-bottom mb-3">
                        <span class="cart__total-position-title col-6 col-lg-12 text-center font-weight-bold">Position price:</span>
                        <span class="cart__total-position-old-price col-3 col-lg-3 text-right text-muted mb-2">
                            <span class="cart__total-position-old-price-value {% if obCartPositionList.getDiscountTotalPriceValue() == 0 %}d-none{% endif %}">{{ obCartPositionList.getOldTotalPrice() }}{{ Cart.getCurrency() }}</span>
<!--                <span class="cart__total-position-old-price-currency {% if obCartPositionList.getDiscountTotalPriceValue() == 0 %}d-none{% endif %}"></span>-->
                        </span>
                        <span class="d-none d-lg-block">|</span>
                        <span class="cart__total-position-current-price col-3 col-lg-3 text-right mb-2">
                            <span class="cart__total-position-price-value">{{ obCartPositionList.getTotalPrice() }}{{ Cart.getCurrency() }}</span>
<!--                <span class="cart__total-position-price-currency"></span>-->
                        </span>
                    </div>
                    <div class="cart__total-shipping row justify-content-lg-around mb-3">
                        <span class="cart__total-shipping-title col-6 col-lg-12 font-weight-bold text-center">Shipping price:</span>
                        <span class="cart__total-shipping-old-price col-3 col-lg-12 text-right text-lg-center text-muted">
                <span class="cart__total-shipping-old-price-value {% if obActiveShippingType.discount_price_value == 0 %}d-none{% endif %}">{{ obActiveShippingType.old_price }} {{ Cart.getCurrency() }}</span>
<!--                <span class="cart__total-shipping-old-price-currency {% if obActiveShippingType.discount_price_value == 0 %}d-none{% endif %}"></span>-->
            </span>
                        <span class="cart__total-shipping-current-price col-3 col-lg-12 text-right text-lg-center">
                <span class="cart__total-shipping-price-value">{{ obActiveShippingType.price }} {{ Cart.getCurrency() }}</span>
<!--                <span class="cart__total-shipping-price-currency"></span>-->
            </span>
                    </div>
                    <div class="cart__total-price row justify-content-lg-around mb-3 pt-3">
                        <span class="cart__total-price-title col-6 col-lg-12 font-weight-bold text-center">Total price:</span>
                        <span class="cart__total-price-old-price col-3 col-lg-12 text-right text-muted text-lg-center">
                <span class="cart__total-price-old-price-value {% if Cart.getDiscountTotalPriceValue() == 0 %}d-none{% endif %}">{{ Cart.getOldTotalPrice() }}{{ Cart.getCurrency() }}</span>
<!--                <span class="cart__total-price-old-price-currency {% if Cart.getDiscountTotalPriceValue() == 0 %}d-none{% endif %}"></span>-->
            </span>
                        <span class="cart__total-price-current-price col-3 col-lg-12 text-right text-lg-center">
                <span class="cart__total-price-price-value">{{ Cart.getTotalPrice() }}{{ Cart.getCurrency() }}</span>
<!--                <span class="cart__total-price-price-currency"></span>-->
            </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <div class="cart__empty container {% if obCartPositionList.isNotEmpty() %}d-none{% endif %}">
        <div class="my-5 row justify-content-center">
            <div class="alert alert-info">
                <h2 class="mt-4 mb-4 text-center">
                    Your cart is empty.
                </h2>
            </div>
        </div>
    </div>
</section>


